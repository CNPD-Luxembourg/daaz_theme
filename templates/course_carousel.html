{% load i18n %}
{% load static %}
{% load django_bootstrap5 %}
{% load custom_filters %}

{% block bootstrap5_extra_script %}
<script src='{% static "js/course.js" %}'></script>
{% endblock %}

<div class="carousel-inner px-5 h-100" role="listbox">
    {% for slide in slides %}
    <div class="carousel-item h-100 pb-sm-5 {% if forloop.first %} active {% endif %}">
        {% if slide.question %}
        <div class="col card border border-primary p-sm-5 p-2 mx-auto h-100">
            <form method="post">
                <h3 class="text-primary">{% translate "Question"%} {{ slide.question.question_index }}</h3>
                {% csrf_token %}
                {% bootstrap_form_errors slide.question %}
                {% bootstrap_field slide.question.answer show_label=True label_class="pb-3" %}
                <div class="text-center py-sm-5 py-3 inFront">
                    <button id="summitButton" type="summit"
                        class="btn text-primary course-button fw-bolder border-primary border border-3 shadow rounded p-2">
                        {% translate "Valider" %}
                    </button>
                </div>
            </form>
        </div>
        {% elif slide.context %}
        <div class="col card border border-primary p-sm-5 p-2 mx-auto h-100">
            {% for text in slide.context.texts %}
            <span class="inFront {{ text.css_classes|join:' ' }} {{ text.position }}">
                {{ text.text.description|safe }}
            </span>
            {% endfor %}
            {% for media in slide.context.medias %}
            {% if media.media.get_m_type_display == 'Image' %}
            <img class="img-fluid {{ media.css_classes|join:' ' }} {{ media.position }}"
                src="{% static media.media.path|extract_static %}" alt="{{ media.media.name }}" />
            {% endif %}
            {% endfor %}
        </div>

        {% elif slide.challenge %}
        <div class="col card border border-danger p-sm-5 p-2 mx-auto h-100">
            <div class="text-center text-danger">
                <h1 class="fw-bolder">
                    {% translate "Challenge" %} !
                </h1>
                <h6 class="inFront">
                    {{ slide.challenge.name }}
                </h6>
            </div>
            <div class="inFront">
                <p>
                    {{ slide.challenge.description|linebreaks|safe }}
                </p>
            </div>
            <div class="text-center py-sm-5 py-3 inFront">
                <button id="challengeButton" type="button"
                    class="btn text-danger course-button fw-bolder border-danger border border-3 shadow rounded p-2">
                    {% translate "Télécharger mon template" %}
                </button>
            </div>
            <img class="img-fluid BR overlapBR" src="{% static 'media/images/course/challenge/cup.svg' %}" alt="Cup" />
        </div>
        {% endif %}
    </div>
    {% endfor %}
</div>

<a class="carousel-control-prev w-auto previous_slide {% if progress == 0 %}control_disabled{% endif %}" type="button" data-bs-target="#carouselCourse" data-bs-slide="prev" >
    <span class="carousel-control-prev-icon text-primary" aria-hidden="true"></span>
    <span class="visually-hidden">Previous</span>
</a>
<a class="carousel-control-next w-auto next_slide {% if not next_control_enable %}control_disabled{% endif %}" type="button" data-bs-target="#carouselCourse" data-bs-slide="next">
    <span class="carousel-control-next-icon" aria-hidden="true"></span>
    <span class="visually-hidden">Next</span>
</a>
