{% extends 'main.html' %}
{% load i18n %}
{% load static %}
{% load custom_filters %}

{% block bootstrap5_extra_head %}
{{ block.super}}
<script src='{% static "npm_components/chart.js/dist/chart.umd.js" %}'></script>
<link rel="stylesheet" type="text/css" href="{% static 'css/dashboard.css' %}">
{% endblock %}

{% block bootstrap5_extra_script %}
{{ progress|json_script:"progress-data" }}
<script src='{% static "js/dashboard.js" %}'></script>
{% endblock %}

{% block content_area %}
<div class="row h-100">
  <div class="col-md-6 col-12 h-100 w-45">
    <div class="border shadow-sm rounded-4 px-4 py-3 h-49">
      <h4>{% translate "Mes cours" %}</h4>
      <div class="row h-45">
        {% for score in scores %}
        <div class="col-md-6 col-12 p-0 h-100">
          <div class="p-2 h-100">
            <div class="bg-light-blue rounded-3 pt-2 px-2 h-100">
              <div class="row p-4 p-sm-2 h-50">
                <div class="col-6 pe-0 h-100">
                  <p class="small d-flex align-items-center m-0 text-nowrap h-auto">
                    {{ score.level.name }}
                  </p>
                  <h6 class="fw-semibold m-0 pb-1 d-flex align-items-center h-auto">
                    {% translate "Module" %} {{ score.level.index }}
                  </h6>
                </div>
                <div class="col-6 text-center h-100">
                  <img src="{% static 'media/images/course/levels/level-'%}{{score.level.index}}.svg"
                    class="img-fluid h-100" />
                </div>
              </div>

              <div class="row p-4 p-sm-2 h-50">
                <div class="col-8 d-flex align-items-end h-50">
                  <div class="small fw-semibold">{% translate "Progression:" %}</div>
                </div>
                <div class="col-4 d-flex align-items-end justify-content-end h-50">
                  <div class="mb-0 fw-bold">
                    {{ score.progress }}%
                  </div>
                </div>

                <div class="col d-flex align-items-center h-50">
                  <div class="progress bg-white w-100" style="height:50% !important">
                    <div class="progress-bar" role="progressbar" style="width: {{ score.progress }}%"
                      aria-valuenow="{{ score.progress }}" aria-valuemin="0" aria-valuemax="100"></div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        {% endfor %}
      </div>
    </div>
    <div class="h-2"></div>
    <div class="border shadow-sm rounded-4 px-4 py-3 h-49">
      <h4>{% translate "Connaissances" %}</h4>
      <div class="d-flex flex-column h-95">
        {% for c in criteria.data %}
        <div class="h-10">
          <div class="small d-flex align-items-end h-50">
            {{ c.label }}
          </div>
          <div class="d-flex align-items-center h-50">
            <div class="progress bg-light-blue w-100" style="height: 50% !important;">
              <div class="progress-bar" role="progressbar" style="width: {% widthratio c.value 1 100 %}%"
                aria-valuenow="{{ c.value }}" aria-valuemin="0" aria-valuemax="1"></div>
            </div>
            <div class="small mx-2">
              {% widthratio c.value 1 100 %}%
            </div>
          </div>
        </div>

        {% endfor %}
      </div>
    </div>
  </div>
  <div class="col-md-6 col-12 h-100 w-55">
    <div class="border shadow-sm rounded-4 px-4 py-3 h-100">
      <h4 class="pt-2">{% translate "Résultats" %}</h4>
      <div class="px-3 h-100">
        {% for score in scores %}
        <div class="row h-20">
          <div class="col-md-6 col-12 h-100">
            <div class="row border border-primary rounded-3 h-100">
              <div class="col-md-6 col-12 py-2 h-100">
                <h5 class="fw-semibold m-0">{% translate "Module" %} {{ score.level.index }}</h5>
                <span>{{ score.level.name }}</span>
              </div>
              <div class="col-md-6 col-12 position-relative d-flex align-items-center justify-content-center h-100">
                <div class="h-85 w-85">
                  <canvas id="progress{{ score.level.index }}"></canvas>
                </div>
                <div class="position-absolute text-center top-50 start-50 translate-middle lh-1">
                  <h4 class="mb-0 fw-bold">
                    {{ score.score }}%
                  </h4>
                  <div class="small fw-semibold">
                    {% translate "De réussite" %}
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="col-md-6 col-12 text-end p-0 h-100">
            <img src="{% static 'media/images/stickers/level-'%}{{ score.level.index }}-1.svg" alt="Sticker"
              class="img-fluid h-100" />
          </div>
        </div>
        <div class="row h-3"></div>
        {% endfor %}
      </div>
    </div>
  </div>
</div>
{% endblock %}
